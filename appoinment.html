<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<form id="appointmentForm" autocomplete="off">

<title>Make an Appointment</title>
<style>
:root {
  --primary: #f0326b;
  --secondary: #f96e95;
  --success: #10b981;
  --danger: #ef4444;
  --info: #3b82f6;
  --light: #f8fafc;
  --dark: #1e293b;
}
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg,#e0e7ff,#f1f5f9 100%);
  margin: 0; min-height: 100vh;
}
.container {
  max-width: 420px;
  margin: 3rem auto;
  background: #fff;
  border-radius: 18px;
  box-shadow: 0 4px 30px #b20075;
  padding: 2.3rem 2rem 2rem 2rem;
  position: relative;
}
h1 {
  font-weight: 900;
  font-size: 2rem;
  letter-spacing: -1px;
  margin-bottom: 2rem;
  text-align: left;
  background: linear-gradient(to right, var(--dark), var(--primary));
  background-clip: text;
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
form label {
  font-size: 1.07rem; font-weight: 600;
  margin-bottom: 0.22rem; display: block;
}
input, select, textarea {
  width: 100%; margin-bottom: 1.1rem;
  padding: 0.85rem;
  border-radius: 8px; font-size: 1.06rem;
  border: 2px solid #fcebd4; background: #fcebd4;
  transition: border 0.2s;
  box-sizing: border-box;
}
input:focus, select:focus, textarea:focus {
  border-color: var(--primary); outline: none;
  background: #fcebd4;
}
select {
  padding-right: 2rem;
  background: #fcebd4 url('data:image/svg+xml;utf8,<svg fill="gray" height="16" viewBox="0 0 20 20" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M7.293 7.707a1 1 0 011.414 0L10 9l1.293-1.293a1 1 0 011.414 1.414L10 11.414 7.293 8.707a1 1 0 010-1.414z"></path></svg>') no-repeat right 1rem center;
  background-size: 1.2em;
}
textarea {
  min-height: 60px;
  max-height: 150px;
  resize: vertical;
}
button[type="submit"] {
  width: 100%; margin-top: 0.7rem;
  padding: 0.89rem 1rem;
  border: none; border-radius: 25px; font-weight: 700;
  font-size: 1.11rem; letter-spacing: 0.05em;
  background: linear-gradient(80deg, var(--primary), var(--secondary));
  color: #7d154c; cursor: pointer; box-shadow: 0 2px 10px #f0326a22;
  transition: background 0.14s,box-shadow 0.14s;
}
button[type="submit"]:hover {
  filter: brightness(1.09);
  box-shadow: 0 4px 18px #f0326a33;
}
.close-x {
  position: absolute; right: 12px; top: 13px;
  font-size: 1.6rem; color: #888;
  cursor: pointer; font-weight: 900;
  line-height: 1.0;
  transition: color 0.17s;
}
.close-x:hover { color: #f0326b; }
@media (max-width:530px) {
  .container { padding: 1rem; }
  h1 { font-size: 1.4rem; }
}
</style>
</head>
<body>
  <div class="container">

    <div class="close-x" title="Close">&times;</div>
    


    <h1>Make an appointment</h1>
    <form id="appointmentForm" autocomplete="off">
      <label for="name">Name</label>
      <input type="text" id="name" name="name" required/>

      <label for="email">Email</label>
      <input type="email" id="email" name="email" required/>

      <label for="phone">Phone</label>
      <input type="tel" id="phone" name="phone" pattern="[0-9\-+() ]*" required/>

      <label for="location">Location</label>
      <input type="text" id="location" name="location" placeholder="Your location" required />
      <button type="button" onclick="autoDetectLocation()" style="margin-bottom:1em;background:var(--info);color:#fff;border:none;border-radius:8px;padding:0.5em 1em;cursor:pointer;">Detect My Location</button>

      <label for="speciality">Health Concern</label>
      <select id="speciality" name="speciality" required>
        <option value="">- Select Health Concern -</option>
        <option value="general">General Health (common illness, checkups)</option>
        <option value="cardiology">Heart Problems (chest pain, high blood pressure)</option>
        <option value="pediatrics">Kidsâ€™ Health (child illnesses, vaccinations)</option>
        <option value="dermatology">Skin Problems (rashes, acne, allergy)</option>
        <option value="neurology">Brain & Nerves (headaches, dizziness, seizures)</option>
        <option value="orthopedics">Bone & Joints (pain, fractures, arthritis)</option>
        <option value="others">Others / Unsure</option>
      </select>

      <label for="date">Enter Date</label>
      <input type="date" id="date" name="date" required min=""/>

      <label for="messages">Messages</label>
      <textarea id="messages" name="messages" placeholder="Describe your issue / message (optional)"></textarea>

      <button type="submit">SUBMIT</button>
    </form>
    <div id="form-status" style="padding:0.7em 0 0.2em 0;text-align:center;color:var(--primary);font-weight:600;display:none"></div>
  </div>

<script>
  // Set the min attribute of date input to today
  document.getElementById('date').min = new Date().toISOString().split('T')[0];

  document.querySelector('.close-x').onclick = () => {
    document.querySelector('.container').style.display = 'none';
  };

  document.querySelector('.close-x').addEventListener('click', () => {
  window.location.href = 'index.html';  // Adjust the path if needed
});

    document.getElementById('appointmentForm').addEventListener('submit', async (e) => {
  e.preventDefault(); // Stop the form from submitting normally (no page refresh)

  // Collect data from form inputs
  const form = e.target;
  const formData = {
    name: form.name.value.trim(),
    email: form.email.value.trim(),
    phone: form.phone.value.trim(),
    location: form.location.value.trim(),
    speciality: form.speciality.value,
    date: form.date.value,
    messages: form.messages.value.trim(),
  };

  // Basic validation (you can add more advanced checks here)
  if (!formData.name || !formData.email || !formData.phone || !formData.location || !formData.speciality || !formData.date) {
    alert("Please fill all required fields.");
    return;
  }

  try {
    // Send POST request with the form data as JSON
    const response = await fetch('/api/appointments', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData)
    });

    // Parse the JSON response from backend
    const result = await response.json();

    if (response.ok) {
      alert("Appointment submitted successfully! Your reference ID: " + result.appointmentId);
      form.reset(); // Clear the form
    } else {
      alert("Error: " + (result.error || "Unknown error"));
    }
  } catch (err) {
    alert("Network error. Please try again.");
    console.error(err);
  }
});


  function autoDetectLocation() {
    if (!navigator.geolocation) {
      console.log("Geolocation not supported");
      return;
    }

    navigator.geolocation.getCurrentPosition(async (position) => {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;

      const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`;

      try {
        const resp = await fetch(url);
        if (!resp.ok) throw new Error("Reverse geocoding failed");
        const data = await resp.json();
              const address = data.address;
              const locationName = address.city || address.town || address.village || address.county || '';
              document.getElementById('location').value = locationName;
            } catch (err) {
              console.log("Location detection error:", err);
            }
          }, (err) => {
                    console.log("Geolocation error:", err);
                  });
                }



                
        </script>
        </body>
        </html>